#include <stdlib.h>
#include "xparameters.h"
#include "xdokmean.h"
#include "xaxidma.h"

XDokmean dokmean;
XDokmean_Config *dokmean_cfg;
XAxiDma axiDMA;
XAxiDma_Config *axiDMA_cfg;


int *shared_mem = (int*) 0x00000000+50;


int initPeripherals(){

	dokmean_cfg = XDokmean_LookupConfig(XPAR_XDOKMEAN_0_DEVICE_ID);
	if(dokmean_cfg){
		int status = XDokmean_CfgInitialize(&dokmean, dokmean_cfg);
		if(status != XST_SUCCESS){
			return 1;
		}
	}

	axiDMA_cfg = XAxiDma_LookupConfig(XPAR_AXIDMA_0_DEVICE_ID);
	if(axiDMA_cfg){
		int stat = XAxiDma_CfgInitialize(&axiDMA,axiDMA_cfg);
		if(stat != XST_SUCCESS){
			return 1;
		}
	}

	XAxiDma_IntrDisable(&axiDMA, XAXIDMA_IRQ_ALL_MASK, XAXIDMA_DEVICE_TO_DMA);
	XAxiDma_IntrDisable(&axiDMA, XAXIDMA_IRQ_ALL_MASK, XAXIDMA_DMA_TO_DEVICE);

	return 0;

}

int main(){
	int start = 0;
	while(1){
		start = shared_mem [1];
		if(start == 1){
			break;
		}
	}
	/*float* a = (float*) shared_mem[2];
	shared_mem[3] = a;
	shared_mem[0] = 1;
     */
	int counter =0 ;
	while(1){
		shared_mem[0] = counter;
		counter += 1;
		usleep(1000);
	}
	return 0;
}
